<html>
    <head>
        <title>Bitsy Game Generator</title>
        <style>
            body{
                padding: 0px;
                margin: 0px;
                overflow: hidden;
                background-color: darkslateblue;
            }

            .toolbar{
                position: fixed;
                width:100%;
                height: 10%;
                color: white;
                background-color: darkslateblue;
                padding-top: 10px;
                padding-bottom: 10px;
            }
            .projectName{
                position: absolute;
                left:0%;
                padding-left: 10px;
                font-size: 32px;
                padding-top:5px;
            }
            .generateButton{
                position: absolute;
                right:0%;
                cursor: pointer;
                font-size: 32px;
                padding-right: 10px;
                padding-top:5px;
            }
            .generateButton:hover{
                text-decoration: underline;
            }
            #playButton{
                display: block;
            }
            #stopButton{
                display: none;
            }
            .toolarea{
                position: fixed;
                top:10%;
                width: 100%;
                height: 85%;
            }
            .leftpanel{
                position: absolute;
                width: 48%;
                left: 0%;
                height: 100%;
                margin: 0px;
                padding: 0px;
                margin-left: 10px;
            }
            #inputText{
                position: absolute;
                padding: 0px;
                margin: 0px;
                width: 100%;
                height: 100%;
                border: 0px;
                font-size: 16px;
            }
            .rightpanel{
                position: absolute;
                width: 48%;
                right: 0%;
                height: 100%;
                margin: 0px;
                padding: 0px;
                margin-right: 10px;
            }
            #game {
                position: absolute;
                width:100%;
                height: 100%;
            }
            .footer{
                position: fixed;
                top:95%;
                width:100%;
                height:5%;
            }
            .affliation{
                position: absolute;
                color: white;
                width: 50%;
                padding-top: 8px;
                padding-left: 10px;
                padding-right:10px;
            }
            .affliation > a{
                color:white;
                text-decoration: none;
            }
            .affliation > a:hover{
                color:white;
                text-decoration: underline;
            }
        </style>
        <script type="bitsyFontData" id="ascii_small">
            FONT ascii_small
SIZE 6 8
CHAR 0
000000
000000
000000
000000
000000
000000
000000
000000
CHAR 1
001110
010001
011011
010001
010101
010001
001110
000000
CHAR 2
001110
011111
010101
011111
010001
011111
001110
000000
CHAR 3
000000
001010
011111
011111
011111
001110
000100
000000
CHAR 4
000000
000000
001010
001110
001110
000100
000000
000000
CHAR 5
000100
001110
001110
000100
011111
011111
000100
000000
CHAR 6
000000
000100
001110
011111
011111
000100
001110
000000
CHAR 7
000000
000000
000000
001100
001100
000000
000000
000000
CHAR 8
111111
111111
111111
110011
110011
111111
111111
111111
CHAR 9
000000
000000
011110
010010
010010
011110
000000
000000
CHAR 10
111111
111111
100001
101101
101101
100001
111111
111111
CHAR 11
000000
000111
000011
001101
010010
010010
001100
000000
CHAR 12
001110
010001
010001
001110
000100
001110
000100
000000
CHAR 13
000100
000110
000101
000100
001100
011100
011000
000000
CHAR 14
000011
001101
001011
001101
001011
011011
011000
000000
CHAR 15
000000
010101
001110
011011
001110
010101
000000
000000
CHAR 16
001000
001100
001110
001111
001110
001100
001000
000000
CHAR 17
000010
000110
001110
011110
001110
000110
000010
000000
CHAR 18
000100
001110
011111
000100
011111
001110
000100
000000
CHAR 19
001010
001010
001010
001010
001010
000000
001010
000000
CHAR 20
001111
010101
010101
001101
000101
000101
000101
000000
CHAR 21
001110
010001
001100
001010
000110
010001
001110
000000
CHAR 22
000000
000000
000000
000000
000000
011110
011110
000000
CHAR 23
000100
001110
011111
000100
011111
001110
000100
001110
CHAR 24
000100
001110
011111
000100
000100
000100
000100
000000
CHAR 25
000100
000100
000100
000100
011111
001110
000100
000000
CHAR 26
000000
000100
000110
011111
000110
000100
000000
000000
CHAR 27
000000
000100
001100
011111
001100
000100
000000
000000
CHAR 28
000000
000000
000000
010000
010000
010000
011111
000000
CHAR 29
000000
001010
001010
011111
001010
001010
000000
000000
CHAR 30
000100
000100
001110
001110
011111
011111
000000
000000
CHAR 31
011111
011111
001110
001110
000100
000100
000000
000000
CHAR 32
000000
000000
000000
000000
000000
000000
000000
000000
CHAR 33
000100
001110
001110
000100
000100
000000
000100
000000
CHAR 34
011011
011011
010010
000000
000000
000000
000000
000000
CHAR 35
000000
001010
011111
001010
001010
011111
001010
000000
CHAR 36
001000
001110
010000
001100
000010
011100
000100
000000
CHAR 37
011001
011001
000010
000100
001000
010011
010011
000000
CHAR 38
001000
010100
010100
001000
010101
010010
001101
000000
CHAR 39
001100
001100
001000
000000
000000
000000
000000
000000
CHAR 40
000100
001000
001000
001000
001000
001000
000100
000000
CHAR 41
001000
000100
000100
000100
000100
000100
001000
000000
CHAR 42
000000
001010
001110
011111
001110
001010
000000
000000
CHAR 43
000000
000100
000100
011111
000100
000100
000000
000000
CHAR 44
000000
000000
000000
000000
000000
001100
001100
001000
CHAR 45
000000
000000
000000
011111
000000
000000
000000
000000
CHAR 46
000000
000000
000000
000000
000000
001100
001100
000000
CHAR 47
000000
000001
000010
000100
001000
010000
000000
000000
CHAR 48
001110
010001
010011
010101
011001
010001
001110
000000
CHAR 49
000100
001100
000100
000100
000100
000100
001110
000000
CHAR 50
001110
010001
000001
000110
001000
010000
011111
000000
CHAR 51
001110
010001
000001
001110
000001
010001
001110
000000
CHAR 52
000010
000110
001010
010010
011111
000010
000010
000000
CHAR 53
011111
010000
010000
011110
000001
010001
001110
000000
CHAR 54
000110
001000
010000
011110
010001
010001
001110
000000
CHAR 55
011111
000001
000010
000100
001000
001000
001000
000000
CHAR 56
001110
010001
010001
001110
010001
010001
001110
000000
CHAR 57
001110
010001
010001
001111
000001
000010
001100
000000
CHAR 58
000000
000000
001100
001100
000000
001100
001100
000000
CHAR 59
000000
000000
001100
001100
000000
001100
001100
001000
CHAR 60
000010
000100
001000
010000
001000
000100
000010
000000
CHAR 61
000000
000000
011111
000000
000000
011111
000000
000000
CHAR 62
001000
000100
000010
000001
000010
000100
001000
000000
CHAR 63
001110
010001
000001
000110
000100
000000
000100
000000
CHAR 64
001110
010001
010111
010101
010111
010000
001110
000000
CHAR 65
001110
010001
010001
010001
011111
010001
010001
000000
CHAR 66
011110
010001
010001
011110
010001
010001
011110
000000
CHAR 67
001110
010001
010000
010000
010000
010001
001110
000000
CHAR 68
011110
010001
010001
010001
010001
010001
011110
000000
CHAR 69
011111
010000
010000
011110
010000
010000
011111
000000
CHAR 70
011111
010000
010000
011110
010000
010000
010000
000000
CHAR 71
001110
010001
010000
010111
010001
010001
001111
000000
CHAR 72
010001
010001
010001
011111
010001
010001
010001
000000
CHAR 73
001110
000100
000100
000100
000100
000100
001110
000000
CHAR 74
000001
000001
000001
000001
010001
010001
001110
000000
CHAR 75
010001
010010
010100
011000
010100
010010
010001
000000
CHAR 76
010000
010000
010000
010000
010000
010000
011111
000000
CHAR 77
010001
011011
010101
010001
010001
010001
010001
000000
CHAR 78
010001
011001
010101
010011
010001
010001
010001
000000
CHAR 79
001110
010001
010001
010001
010001
010001
001110
000000
CHAR 80
011110
010001
010001
011110
010000
010000
010000
000000
CHAR 81
001110
010001
010001
010001
010101
010010
001101
000000
CHAR 82
011110
010001
010001
011110
010010
010001
010001
000000
CHAR 83
001110
010001
010000
001110
000001
010001
001110
000000
CHAR 84
011111
000100
000100
000100
000100
000100
000100
000000
CHAR 85
010001
010001
010001
010001
010001
010001
001110
000000
CHAR 86
010001
010001
010001
010001
010001
001010
000100
000000
CHAR 87
010001
010001
010101
010101
010101
010101
001010
000000
CHAR 88
010001
010001
001010
000100
001010
010001
010001
000000
CHAR 89
010001
010001
010001
001010
000100
000100
000100
000000
CHAR 90
011110
000010
000100
001000
010000
010000
011110
000000
CHAR 91
001110
001000
001000
001000
001000
001000
001110
000000
CHAR 92
000000
010000
001000
000100
000010
000001
000000
000000
CHAR 93
001110
000010
000010
000010
000010
000010
001110
000000
CHAR 94
000100
001010
010001
000000
000000
000000
000000
000000
CHAR 95
000000
000000
000000
000000
000000
000000
000000
111111
CHAR 96
001100
001100
000100
000000
000000
000000
000000
000000
CHAR 97
000000
000000
001110
000001
001111
010001
001111
000000
CHAR 98
010000
010000
011110
010001
010001
010001
011110
000000
CHAR 99
000000
000000
001110
010001
010000
010001
001110
000000
CHAR 100
000001
000001
001111
010001
010001
010001
001111
000000
CHAR 101
000000
000000
001110
010001
011110
010000
001110
000000
CHAR 102
000110
001000
001000
011110
001000
001000
001000
000000
CHAR 103
000000
000000
001111
010001
010001
001111
000001
001110
CHAR 104
010000
010000
011100
010010
010010
010010
010010
000000
CHAR 105
000100
000000
000100
000100
000100
000100
000110
000000
CHAR 106
000010
000000
000110
000010
000010
000010
010010
001100
CHAR 107
010000
010000
010010
010100
011000
010100
010010
000000
CHAR 108
000100
000100
000100
000100
000100
000100
000110
000000
CHAR 109
000000
000000
011010
010101
010101
010001
010001
000000
CHAR 110
000000
000000
011100
010010
010010
010010
010010
000000
CHAR 111
000000
000000
001110
010001
010001
010001
001110
000000
CHAR 112
000000
000000
011110
010001
010001
010001
011110
010000
CHAR 113
000000
000000
001111
010001
010001
010001
001111
000001
CHAR 114
000000
000000
010110
001001
001000
001000
011100
000000
CHAR 115
000000
000000
001110
010000
001110
000001
001110
000000
CHAR 116
000000
001000
011110
001000
001000
001010
000100
000000
CHAR 117
000000
000000
010010
010010
010010
010110
001010
000000
CHAR 118
000000
000000
010001
010001
010001
001010
000100
000000
CHAR 119
000000
000000
010001
010001
010101
011111
001010
000000
CHAR 120
000000
000000
010010
010010
001100
010010
010010
000000
CHAR 121
000000
000000
010010
010010
010010
001110
000100
011000
CHAR 122
000000
000000
011110
000010
001100
010000
011110
000000
CHAR 123
000110
001000
001000
011000
001000
001000
000110
000000
CHAR 124
000100
000100
000100
000100
000100
000100
000100
000100
CHAR 125
001100
000010
000010
000011
000010
000010
001100
000000
CHAR 126
001010
010100
000000
000000
000000
000000
000000
000000
CHAR 127
000100
001110
011011
010001
010001
011111
000000
000000
CHAR 128
001110
010001
010000
010000
010001
001110
000100
001100
CHAR 129
010010
000000
010010
010010
010010
010110
001010
000000
CHAR 130
000011
000000
001110
010001
011110
010000
001110
000000
CHAR 131
001110
000000
001110
000001
001111
010001
001111
000000
CHAR 132
001010
000000
001110
000001
001111
010001
001111
000000
CHAR 133
001100
000000
001110
000001
001111
010001
001111
000000
CHAR 134
001110
001010
001110
000001
001111
010001
001111
000000
CHAR 135
000000
001110
010001
010000
010001
001110
000100
001100
CHAR 136
001110
000000
001110
010001
011110
010000
001110
000000
CHAR 137
001010
000000
001110
010001
011110
010000
001110
000000
CHAR 138
001100
000000
001110
010001
011110
010000
001110
000000
CHAR 139
001010
000000
000100
000100
000100
000100
000110
000000
CHAR 140
000100
001010
000000
000100
000100
000100
000110
000000
CHAR 141
001000
000000
000100
000100
000100
000100
000110
000000
CHAR 142
001010
000000
000100
001010
010001
011111
010001
000000
CHAR 143
001110
001010
001110
011011
010001
011111
010001
000000
CHAR 144
000011
000000
011111
010000
011110
010000
011111
000000
CHAR 145
000000
000000
011110
000101
011111
010100
001111
000000
CHAR 146
001111
010100
010100
011111
010100
010100
010111
000000
CHAR 147
001110
000000
001100
010010
010010
010010
001100
000000
CHAR 148
001010
000000
001100
010010
010010
010010
001100
000000
CHAR 149
011000
000000
001100
010010
010010
010010
001100
000000
CHAR 150
001110
000000
010010
010010
010010
010110
001010
000000
CHAR 151
011000
000000
010010
010010
010010
010110
001010
000000
CHAR 152
001010
000000
010010
010010
010010
001110
000100
011000
CHAR 153
010010
001100
010010
010010
010010
010010
001100
000000
CHAR 154
001010
000000
010010
010010
010010
010010
001100
000000
CHAR 155
000000
000100
001110
010000
010000
001110
000100
000000
CHAR 156
000110
001001
001000
011110
001000
001001
010111
000000
CHAR 157
010001
001010
000100
011111
000100
011111
000100
000000
CHAR 158
011000
010100
010100
011010
010111
010010
010010
000000
CHAR 159
000010
000101
000100
001110
000100
000100
010100
001000
CHAR 160
000110
000000
001110
000001
001111
010001
001111
000000
CHAR 161
000110
000000
000100
000100
000100
000100
000110
000000
CHAR 162
000110
000000
001100
010010
010010
010010
001100
000000
CHAR 163
000110
000000
010010
010010
010010
010110
001010
000000
CHAR 164
001010
010100
000000
011100
010010
010010
010010
000000
CHAR 165
001010
010100
000000
010010
011010
010110
010010
000000
CHAR 166
001110
000001
001111
010001
001111
000000
001111
000000
CHAR 167
001100
010010
010010
010010
001100
000000
011110
000000
CHAR 168
000100
000000
000100
001100
010000
010001
001110
000000
CHAR 169
000000
000000
011111
010000
010000
010000
000000
000000
CHAR 170
000000
000000
111111
000001
000001
000000
000000
000000
CHAR 171
010000
010010
010100
001110
010001
000010
000111
000000
CHAR 172
010000
010010
010100
001011
010101
000111
000001
000000
CHAR 173
000100
000000
000100
000100
001110
001110
000100
000000
CHAR 174
000000
000000
001001
010010
001001
000000
000000
000000
CHAR 175
000000
000000
010010
001001
010010
000000
000000
000000
CHAR 176
010101
000000
101010
000000
010101
000000
101010
000000
CHAR 177
010101
101010
010101
101010
010101
101010
010101
101010
CHAR 178
101010
111111
010101
111111
101010
111111
010101
111111
CHAR 179
000100
000100
000100
000100
000100
000100
000100
000100
CHAR 180
000100
000100
000100
111100
000100
000100
000100
000100
CHAR 181
000000
000000
010010
010010
010010
011100
010000
010000
CHAR 182
010100
010100
010100
110100
010100
010100
010100
010100
CHAR 183
000000
000000
000000
111100
010100
010100
010100
010100
CHAR 184
000000
111100
000100
111100
000100
000100
000100
000100
CHAR 185
010100
110100
000100
110100
010100
010100
010100
010100
CHAR 186
010100
010100
010100
010100
010100
010100
010100
010100
CHAR 187
000000
111100
000100
110100
010100
010100
010100
010100
CHAR 188
010100
110100
000100
111100
000000
000000
000000
000000
CHAR 189
010100
010100
010100
111100
000000
000000
000000
000000
CHAR 190
000100
111100
000100
111100
000000
000000
000000
000000
CHAR 191
000000
000000
000000
111100
000100
000100
000100
000100
CHAR 192
000100
000100
000100
000111
000000
000000
000000
000000
CHAR 193
000100
000100
000100
111111
000000
000000
000000
000000
CHAR 194
000000
000000
000000
111111
000100
000100
000100
000100
CHAR 195
000100
000100
000100
000111
000100
000100
000100
000100
CHAR 196
000000
000000
000000
111111
000000
000000
000000
000000
CHAR 197
000100
000100
000100
111111
000100
000100
000100
000100
CHAR 198
000100
000111
000100
000111
000100
000100
000100
000100
CHAR 199
010100
010100
010100
010111
010100
010100
010100
010100
CHAR 200
010100
010111
010000
011111
000000
000000
000000
000000
CHAR 201
000000
011111
010000
010111
010100
010100
010100
010100
CHAR 202
010100
110111
000000
111111
000000
000000
000000
000000
CHAR 203
000000
111111
000000
110111
010100
010100
010100
010100
CHAR 204
010100
010111
010000
010111
010100
010100
010100
010100
CHAR 205
000000
111111
000000
111111
000000
000000
000000
000000
CHAR 206
010100
110111
000000
110111
010100
010100
010100
010100
CHAR 207
000100
111111
000000
111111
000000
000000
000000
000000
CHAR 208
010100
010100
010100
111111
000000
000000
000000
000000
CHAR 209
000000
111111
000000
111111
000100
000100
000100
000100
CHAR 210
000000
000000
000000
111111
010100
010100
010100
010100
CHAR 211
010100
010100
010100
011111
000000
000000
000000
000000
CHAR 212
000000
000000
000000
000000
000000
000000
000000
111111
CHAR 213
000000
000000
000000
000000
000000
000000
111111
111111
CHAR 214
000000
000000
000000
000000
000000
111111
111111
111111
CHAR 215
000000
000000
000000
000000
111111
111111
111111
111111
CHAR 216
000000
000000
000000
111111
111111
111111
111111
111111
CHAR 217
000000
000000
111111
111111
111111
111111
111111
111111
CHAR 218
000000
111111
111111
111111
111111
111111
111111
111111
CHAR 219
111111
111111
111111
111111
111111
111111
111111
111111
CHAR 220
100000
100000
100000
100000
100000
100000
100000
100000
CHAR 221
110000
110000
110000
110000
110000
110000
110000
110000
CHAR 222
111000
111000
111000
111000
111000
111000
111000
111000
CHAR 223
111100
111100
111100
111100
111100
111100
111100
111100
CHAR 224
111110
111110
111110
111110
111110
111110
111110
111110
CHAR 225
000000
011100
010010
011100
010010
010010
011100
010000
CHAR 226
011110
010010
010000
010000
010000
010000
010000
000000
CHAR 227
000000
011111
001010
001010
001010
001010
001010
000000
CHAR 228
001010
000000
001110
000001
001111
010001
001111
000000
CHAR 229
000000
000000
001111
010010
010010
001100
000000
000000
CHAR 230
000000
000000
010010
010010
010010
011100
010000
010000
CHAR 231
000000
000000
001010
010100
000100
000100
000100
000000
CHAR 232
001110
000100
001110
010001
001110
000100
001110
000000
CHAR 233
001100
010010
010010
011110
010010
010010
001100
000000
CHAR 234
000000
001110
010001
010001
001010
001010
011011
000000
CHAR 235
001100
010000
001000
000100
001110
010010
001100
000000
CHAR 236
000000
000000
001010
010101
010101
001010
000000
000000
CHAR 237
000000
000100
001110
010101
010101
001110
000100
000000
CHAR 238
000000
001110
010000
011110
010000
001110
000000
000000
CHAR 239
000000
001100
010010
010010
010010
010010
000000
000000
CHAR 240
000000
011110
000000
011110
000000
011110
000000
000000
CHAR 241
000000
000100
001110
000100
000000
001110
000000
000000
CHAR 242
010000
001100
000010
001100
010000
000000
011110
000000
CHAR 243
000000
000000
111111
111000
100110
100001
100000
111111
CHAR 244
000000
000000
111111
000111
011001
100001
000001
111111
CHAR 245
000100
000100
000100
000100
000100
010100
001000
000000
CHAR 246
001010
000000
001110
010001
010001
010001
001110
000000
CHAR 247
111110
111110
111110
111110
111110
111110
111110
111110
CHAR 248
111100
111100
111100
111100
111100
111100
111100
111100
CHAR 249
111000
111000
111000
111000
111000
111000
111000
111000
CHAR 250
110000
110000
110000
110000
110000
110000
110000
110000
CHAR 251
100000
100000
100000
100000
100000
100000
100000
100000
CHAR 252
001010
000000
010010
010010
010010
010110
001010
000000
CHAR 253
011000
000100
001000
011100
000000
000000
000000
000000
CHAR 254
000000
000000
000000
011110
110010
110011
111110
001111
CHAR 255
010010
111111
010010
010010
111111
010010
000000
000000
        </script>
        <script type="text/javascript" src="js/sentimood.js"></script>
        <script type="text/javascript" src="https://unpkg.com/compromise@latest/builds/compromise.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script type="text/javascript" src="js/tracery.min.js"></script>
        <script type="text/javascript" src="js/helper.js"></script>
        <script type="text/javascript" src="js/markovChain.js"></script>
        <script type="text/javascript" src="js/traceryRules.js"></script>
        <script type="text/javascript" src="js/bitsyCode.js"></script>
        <script type="text/javascript" src="js/cellularGenerator.js"></script>

        <script type="text/javascript" src="js/palleteGenerator.js"></script>
        <script type="text/javascript" src="js/roomGenerator.js"></script>
        <script type="text/javascript" src="js/spriteGenerator.js"></script>
        <script type="text/javascript" src="js/tileGenerator.js"></script>
        <script type="text/javascript">
            let tileIndex = 10;
            let spriteIndex = 10;
            let palleteIndex = 0;
            let endingIndex = 0;
            let roomIndex = 0;
            let avatarNoun = "";

            let avatarMarkov = new Markov2D();
            avatarMarkov.loadFromCSV("assets/avatar.csv");
            let spriteMarkov = new Markov2D();
            spriteMarkov.loadFromCSV("assets/sprites.csv");
            let wallsMarkov = new Markov2D();
            wallsMarkov.loadFromCSV("assets/walls.csv");
            let backgroundMarkov = new Markov2D();
            backgroundMarkov.loadFromCSV("assets/backgrounds.csv");

            let gameNameTracery = new TraceryRules();
            gameNameTracery.loadTraceryRules("assets/gameName.json");
            let nomoreTracery = new TraceryRules();
            nomoreTracery.loadTraceryRules("assets/noMoreDialog.json");
            let fillingTracery = new TraceryRules();
            fillingTracery.loadTraceryRules("assets/edgeDialog.json");

            let endingGraphics = readImageFile("assets/ending.txt");
            let questionGraphics = readImageFile("assets/question.txt");
            let directionGraphics = readImageFile("assets/directions.txt");
            let decorationGraphics = { "neg": [], "pos": [], "neutral": [] };
            let spriteGraphics = {};
            let spritePossibleLines = {};
            let wallGraphics = { "neg": [], "pos": [], "neutral": [] };

            let senti = new Sentimood();

            function initialize(){
                tileIndex = 10;
                spriteIndex = 10;
                palleteIndex = 0;
                endingIndex = 0;
                roomIndex = 0;
                avatarNoun = "";

                decorationGraphics = { "neg": [], "pos": [], "neutral": [] };
                spriteGraphics = {};
                spritePossibleLines = {};
                wallGraphics = { "neg": [], "pos": [], "neutral": [] };

                clearCanvas();
            }

            function getGameName(avatarNoun, sentences){
                let adjectives = gameNameTracery.mainRules.neg_adjective;
                if(getSentiScore(sentences) >= -1){
                    adjectives = gameNameTracery.mainRules.pos_adjective;
                }
                return gameNameTracery.generate({
                    "name": avatarNoun,
                    "adjective": adjectives
                });
            }

            function getGameCode() {
                let inputText = nlp(document.getElementById("inputText").value);
                if(inputText.sentences().length <= 0){
                    alert("You need to have input text to generate a game.");
                    return "";
                }

                avatarNoun = inputText.nouns().out('frequency')[0].normal;
                let uniqueNouns = Array.from(new Set(inputText.nouns().out('array')));
                let sentences = inputText.sentences().out('array');
                let associatedSentences = {}
                for(let n of uniqueNouns){
                    associatedSentences[n] = [];
                    for(let s of sentences){
                        if(nlp(s).match(n).out('array').length > 0){
                            associatedSentences[n].push(s);
                        }
                    }

                    spritePossibleLines[n] = [];
                    let tags = nlp(n).out('tags');
                    let line = "I am a {clr2}{wvy}" + n + "{wvy}{clr2}.";
                    if(n[0] == "a" || n[0] == "i" || n[0] == "o" || n[0] == "e"){
                        line = "I am an {clr2}{wvy}" + n + "{wvy}{clr2}.";
                    }
                    if (tags.indexOf("Person") >= 0) {
                        line = "I am {clr2}{wvy}" + nlp(n).toTitleCase().out() + "{wvy}{clr2}.";
                    }
                    else if (tags.indexOf("Place") >= 0 || tags.indexOf("Organization") >= 0) {
                        line = "I am the {clr2}{wvy}" + nlp(n).toTitleCase().out() + "{clr2}{wvy}.";
                    }
                    spritePossibleLines[n].push(line);
                    $.ajax({
                        url: 'http://api.conceptnet.io/query?node=/c/en/' + n + '&other=/c/en',
                        async: false,
                        dataType: 'json',
                        success: function (response) {
                            for (let e of response.edges) {
                                let text = getTextFromEdge(e, n);
                                if(text.trim().length > 0){
                                    spritePossibleLines[n].push(text);
                                }
                            }
                        }
                    });
                }

                let symFun = makeHorizontalSymmetry;
                if (Math.random() < 0.2) {
                    symFun = makeVerticalSymmetry;
                }
                let sentiScore = getSentiScore(associatedSentences[avatarNoun]);
                let lowEntropy = 0;
                let highEntropy = 0;
                if(sentiScore < -1){
                    lowEntropy = 0.18;
                    highEntropy = 1;
                }
                else if(sentiScore > 1){
                    lowEntropy = 0;
                    highEntropy = 0.1;
                }
                else{
                    lowEntropy = 0.1;
                    highEntropy = 0.18;
                }
                spriteGraphics[avatarNoun] = generateGraphics(avatarMarkov, 10, 30, symFun, lowEntropy, highEntropy);
                for(let n of uniqueNouns){
                    if(n in spriteGraphics){
                        continue;
                    }
                    let sentiScore = getSentiScore(associatedSentences[avatarNoun]);
                    let lowEntropy = 0;
                    let highEntropy = 0;
                    if (sentiScore < -1) {
                        lowEntropy = 0.2;
                        highEntropy = 1;
                    }
                    else if (sentiScore > 1) {
                        lowEntropy = 0;
                        highEntropy = 0.15;
                    }
                    else {
                        lowEntropy = 0.15;
                        highEntropy = 0.2;
                    }
                    spriteGraphics[n] = generateGraphics(spriteMarkov, 15, 35, symFun, lowEntropy, highEntropy);
                }

                for(let i=0; i<Math.min(Math.ceil(sentences.length / 2), 4); i++){
                    wallGraphics["neg"].push(generateGraphics(wallsMarkov, 30, 64, makeCornerSymmetry,0.2, 1));
                    wallGraphics["pos"].push(generateGraphics(wallsMarkov, 30, 64, makeCornerSymmetry, 0, 0.15));
                    wallGraphics["neutral"].push(generateGraphics(wallsMarkov, 30, 64, makeCornerSymmetry, 0.15, 0.2));

                    let symFun = makeLeftCornerSymmetry;
                    if (Math.random() < 0.5) {
                        symFun = makeRightCornerSymmetry;
                    }
                    decorationGraphics["neg"].push(generateGraphics(backgroundMarkov, 5, 20, symFun, 0.15, 1));
                    decorationGraphics["pos"].push(generateGraphics(backgroundMarkov, 5, 20, symFun, 0, 0.1));
                    decorationGraphics["neutral"].push(generateGraphics(backgroundMarkov, 5, 20, symFun, 0.1, 0.15));
                }

                // Generate the actual data objects
                let gameName = getGameName(avatarNoun, sentences);
                let palletes = getPalletes();
                let spriteLines = getSprites(sentences);
                let wallTiles = getWallTiles(sentences);
                let decorTiles = getDecorTiles(sentences);
                let directionTiles = getDirectionTiles();

                //Convert to array
                let walls = [];
                for(let type in wallTiles){
                    for(let t of wallTiles[type]){
                        walls.push(t);
                    }
                }
                let decors = [];
                for (let type in decorTiles) {
                    for (let t of decorTiles[type]) {
                        decors.push(t);
                    }
                }
                for(let t of directionTiles){
                    decors.push(t);
                }
                let sprites = [getAvatarSprite()];
                sprites[0].isAvatar = true;
                for(let index in spriteLines){
                    for(let s of spriteLines[index]){
                        sprites.push(s);
                    }
                }

                //orchestrat everything
                let rooms = getRooms(sentences, sprites[0], palletes, spriteLines, wallTiles, decorTiles, directionTiles);

                //Output Text
                let outputText = gameName + "\n";
                outputText += "\n";
                outputText += "# BITSY VERSION 6.2\n" +
                                "\n" +
                                "! ROOM_FORMAT 1\n";
                for(let p of palletes){
                    outputText += "\n" + p.toString();
                }
                for(let r of rooms){
                    outputText += "\n" + r.toString();
                }
                for(let d of decors){
                    outputText += "\n" + d.toString();
                }
                for (let w of walls) {
                    outputText += "\n" + w.toString();
                }
                for (let s of sprites) {
                    outputText += "\n" + s.toString();
                }
                outputText += "\n" + rooms[rooms.length - 1].getEndingItem();
                for (let s of sprites){
                    if(s.hasDialog()){
                        outputText += "\n" + s.getDialogString();
                    }
                }
                for (let r of rooms) {
                    if (r.hasEndings()) {
                        outputText += "\n" + r.getEndingString();
                    }
                }
                return outputText;

            }
            function startExportedGame() {
                let code = getGameCode();
                if(code.length > 0){
                    document.getElementById("playButton").style.display = "none";
                    document.getElementById("stopButton").style.display = "block";
                    document.getElementById("inputText").disabled = true;
                    attachCanvas(document.getElementById("game"));
                    load_game(code);
                }

            }

            function stopExportedGame(){
                document.getElementById("playButton").style.display = "block";
                document.getElementById("stopButton").style.display = "none";
                document.getElementById("inputText").disabled = false;
                stopGame();
                clearGameData();
                initialize();
            }

            function clearCanvas(){
                let canvas = document.getElementById("game");
                let context = canvas.getContext("2d");
                context.fillStyle = "#000000";
                context.fillRect(0, 0, canvas.width, canvas.height);
            }
        </script>
    </head>
    <body onload="initialize()">
        <div class="toolbar">
            <div class="projectName">BITSY-DO Game Generator</div>
            <div id="playButton" class="generateButton" onclick="startExportedGame()">&#x25b6; PLAY</div>
            <div id="stopButton" class="generateButton" onclick="stopExportedGame()">&#9724; STOP</div>
        </div>
        <div class="toolarea">
            <div class="leftpanel">
                <textarea id='inputText' placeholder="Enter your game story here (Please write in Present Tense and avoid using Pronouns for better results)."></textarea>
            </div>
            <div class="rightpanel">
                <canvas id='game'></canvas>
            </div>
        </div>
        <div class="footer">
            <div class="affliation" style="text-align: left">Tool by <a href="http://www.akhalifa.com">Ahmed Khalifa</a></div>
            <div class="affliation" style="text-align: right; right: 0%;">Grab the code from <a href="https://github.com/amidos2006/BitsyDo">Github</a></div>
        </div>
    </body>
</html>
